{
  "language": "javascript",
  "views": {
    "by_name": {
      "map": "function(doc){
        if (doc.type == 'Stop'){
          emit([doc.name, doc.location], doc);
        }
      }"
    }
  },
  "lists":{
    "filter": "function(head,req){
      var q = req.query;
      var result = head;
      delete result['update_seq'];
      var rows = Array();
      var row;

      if(q.only){
        if(q.exept)
          return 'blad';

        var only = q.only.split(',');
        while(row = getRow()){
          var i = only.length;
          var new_row = row;
          var doc = {};
          while(i--)
            doc[only[i]] = row['value'][only[i]];
          new_row['value'] = doc;
          rows.push(new_row);
        }
      } else if(q.except) {
        var except = q.except.split(',');
        while(row = getRow()){
          var i = except.length;
          while(i--)
            delete row['value'][except[i]];
          rows.push(row);
        }
      } else
        return 'blad 2';

      result['rows'] = rows;
      return(JSON.stringify(result));
    }"
  }
}
